# ğŸ“‹ ç‰ˆæœ¬ç®¡ç†è„šæœ¬

æœ¬ç›®å½•åŒ…å«ç”¨äºç®¡ç†åº”ç”¨ç‰ˆæœ¬å·çš„å®ç”¨è„šæœ¬ã€‚

## ğŸ“ è„šæœ¬åˆ—è¡¨

### 1. `check_version.sh` - ç‰ˆæœ¬å·æ£€æŸ¥

æ£€æŸ¥ `pubspec.yaml` å’Œ `android/version_code.txt` æ˜¯å¦åŒæ­¥ã€‚

**ç”¨æ³•ï¼š**
```bash
./scripts/check_version.sh
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
========================================
ğŸ“‹ ç‰ˆæœ¬å·åŒæ­¥æ£€æŸ¥
========================================

ğŸ“„ pubspec.yaml:
  å®Œæ•´ç‰ˆæœ¬: 1.0.0+12
  ç‰ˆæœ¬åç§°: 1.0.0
  ç‰ˆæœ¬ä»£ç : 12

ğŸ“„ android/version_code.txt:
  ç‰ˆæœ¬ä»£ç : 12

ğŸ” åŒæ­¥æ£€æŸ¥:
âœ… ç‰ˆæœ¬å·åŒæ­¥æ­£å¸¸

ğŸš€ ä¸‹æ¬¡æ„å»ºç‰ˆæœ¬:
  ç‰ˆæœ¬åç§°: 1.0.0
  ç‰ˆæœ¬ä»£ç : 13
  å®Œæ•´ç‰ˆæœ¬: 1.0.0+13
```

### 2. `sync_version.sh` - ç‰ˆæœ¬å·åŒæ­¥

è‡ªåŠ¨åŒæ­¥ `pubspec.yaml` å’Œ `android/version_code.txt` çš„ç‰ˆæœ¬å·ã€‚

**ç”¨æ³•ï¼š**
```bash
./scripts/sync_version.sh
```

**åŠŸèƒ½ï¼š**
- è¯»å–ä¸¤ä¸ªæ–‡ä»¶çš„ç‰ˆæœ¬å·
- é€‰æ‹©è¾ƒå¤§çš„ç‰ˆæœ¬å·ä½œä¸ºç»Ÿä¸€ç‰ˆæœ¬
- æ›´æ–°ä¸¤ä¸ªæ–‡ä»¶
- æ˜¾ç¤º Git æäº¤å»ºè®®

---

## ğŸ”„ ç‰ˆæœ¬ç®¡ç†å·¥ä½œæµ

### GitHub Actions è‡ªåŠ¨åŒ–ï¼ˆæ¨èï¼‰

**è§¦å‘æ—¶æœºï¼š**
- æ¨é€åˆ° `main` æˆ– `develop` åˆ†æ”¯
- åˆ›å»º `v*` æ ‡ç­¾
- æ‰‹åŠ¨è§¦å‘

**è‡ªåŠ¨åŒ–æµç¨‹ï¼š**
1. âœ… è¯»å– `pubspec.yaml` å’Œ `version_code.txt`
2. âœ… è‡ªåŠ¨é€’å¢ç‰ˆæœ¬å·ï¼ˆå–æœ€å¤§å€¼ +1ï¼‰
3. âœ… ä½¿ç”¨æ–°ç‰ˆæœ¬å·æ„å»º APK
4. âœ… æ„å»ºæˆåŠŸåè‡ªåŠ¨æ›´æ–°ä¸¤ä¸ªæ–‡ä»¶
5. âœ… è‡ªåŠ¨æäº¤æ›´æ–°åˆ°ä»“åº“

**ä¸‹æ¬¡æ„å»ºæ—¶ï¼š**
- ç‰ˆæœ¬å·ä¼šè‡ªåŠ¨ä» 13 é€’å¢åˆ° 14
- æ— éœ€æ‰‹åŠ¨å¹²é¢„

### æœ¬åœ°å¼€å‘å·¥ä½œæµ

#### åœºæ™¯ 1ï¼šæ—¥å¸¸å¼€å‘ï¼ˆä¸éœ€è¦ç‰ˆæœ¬å·ï¼‰
```bash
# æ­£å¸¸å¼€å‘ï¼Œæ— éœ€å…³å¿ƒç‰ˆæœ¬å·
flutter run
```

#### åœºæ™¯ 2ï¼šæœ¬åœ°æµ‹è¯•æ„å»º
```bash
# æ£€æŸ¥å½“å‰ç‰ˆæœ¬
./scripts/check_version.sh

# æ„å»º APKï¼ˆä½¿ç”¨å½“å‰ç‰ˆæœ¬ï¼‰
flutter build apk --release
```

#### åœºæ™¯ 3ï¼šæ‰‹åŠ¨æ›´æ–°ç‰ˆæœ¬å·
```bash
# æ–¹å¼ 1ï¼šè‡ªåŠ¨åŒæ­¥ï¼ˆæ¨èï¼‰
./scripts/sync_version.sh

# æ–¹å¼ 2ï¼šæ‰‹åŠ¨ç¼–è¾‘
# ç¼–è¾‘ pubspec.yaml: version: 1.0.0+12
# ç¼–è¾‘ android/version_code.txt: 12
vim pubspec.yaml
vim android/version_code.txt

# éªŒè¯åŒæ­¥
./scripts/check_version.sh
```

#### åœºæ™¯ 4ï¼šå‡†å¤‡å‘å¸ƒæ–°ç‰ˆæœ¬
```bash
# 1. æ›´æ–°ç‰ˆæœ¬åç§°å’Œä»£ç 
# ç¼–è¾‘ pubspec.yaml
# ä»: version: 1.0.0+12
# åˆ°: version: 1.0.1+13  # ä¿®å¤ç‰ˆæœ¬
# æˆ–: version: 1.1.0+13  # æ–°åŠŸèƒ½ç‰ˆæœ¬

# 2. åŒæ­¥åˆ° version_code.txt
./scripts/sync_version.sh

# 3. æäº¤æ›´æ”¹
git add pubspec.yaml android/version_code.txt
git commit -m "chore: bump version to 1.0.1+13"

# 4. åˆ›å»ºæ ‡ç­¾ï¼ˆå¯é€‰ï¼Œè§¦å‘ Release æ„å»ºï¼‰
git tag v1.0.1
git push origin v1.0.1
```

---

## ğŸ“Š ç‰ˆæœ¬å·è§„åˆ™

### è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆVersion Nameï¼‰

æ ¼å¼ï¼š`MAJOR.MINOR.PATCH`

- **MAJORï¼ˆä¸»ç‰ˆæœ¬ï¼‰**ï¼šä¸å…¼å®¹çš„ API å˜æ›´
  - ä¾‹ï¼š`1.0.0` â†’ `2.0.0`
- **MINORï¼ˆæ¬¡ç‰ˆæœ¬ï¼‰**ï¼šå‘åå…¼å®¹çš„æ–°åŠŸèƒ½
  - ä¾‹ï¼š`1.0.0` â†’ `1.1.0`
- **PATCHï¼ˆä¿®è®¢ç‰ˆï¼‰**ï¼šå‘åå…¼å®¹çš„ Bug ä¿®å¤
  - ä¾‹ï¼š`1.0.0` â†’ `1.0.1`

### Android ç‰ˆæœ¬ä»£ç ï¼ˆVersion Codeï¼‰

- **æ•´æ•°**ï¼Œå¿…é¡»å•è°ƒé€’å¢
- ç”¨äº Android ç³»ç»Ÿåˆ¤æ–­ç‰ˆæœ¬æ–°æ—§
- æ¯æ¬¡å‘å¸ƒå¿…é¡» +1

### å®Œæ•´ç¤ºä¾‹

| ç‰ˆæœ¬åç§° | ç‰ˆæœ¬ä»£ç  | pubspec.yaml | version_code.txt | è¯´æ˜ |
|---------|---------|--------------|------------------|------|
| 1.0.0 | 1 | `version: 1.0.0+1` | `1` | é¦–æ¬¡å‘å¸ƒ |
| 1.0.1 | 2 | `version: 1.0.1+2` | `2` | Bug ä¿®å¤ |
| 1.0.2 | 3 | `version: 1.0.2+3` | `3` | Bug ä¿®å¤ |
| 1.1.0 | 4 | `version: 1.1.0+4` | `4` | æ–°åŠŸèƒ½ |
| 2.0.0 | 5 | `version: 2.0.0+5` | `5` | é‡å¤§æ›´æ–° |

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: ç‰ˆæœ¬å·ä¸åŒæ­¥æ€ä¹ˆåŠï¼Ÿ

**ç­”ï¼š** è¿è¡ŒåŒæ­¥è„šæœ¬
```bash
./scripts/sync_version.sh
```

### Q2: GitHub Actions æ„å»ºåæœ¬åœ°ç‰ˆæœ¬è¿‡æœŸï¼Ÿ

**ç­”ï¼š** æ‹‰å–æœ€æ–°ä»£ç 
```bash
git pull origin develop
./scripts/check_version.sh  # éªŒè¯åŒæ­¥
```

### Q3: å¦‚ä½•è·³è¿‡ç‰ˆæœ¬å·é€’å¢ï¼Ÿ

**ç­”ï¼š** ä¸æ¨èï¼Œä½†å¯ä»¥åœ¨ GitHub Actions è§¦å‘å‰æ‰‹åŠ¨è°ƒæ•´ï¼š
```bash
# è®¾ç½®å›ºå®šç‰ˆæœ¬å·
echo "100" > android/version_code.txt
sed -i 's/^version:.*/version: 2.0.0+100/' pubspec.yaml
git add . && git commit -m "chore: set version to 2.0.0+100"
```

### Q4: å¦‚ä½•æŸ¥çœ‹æ„å»ºå†å²ç‰ˆæœ¬ï¼Ÿ

**ç­”ï¼š** æŸ¥çœ‹ Git æäº¤å†å²
```bash
git log --oneline --grep="ci: update version code"
```

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šæ— æ³•å®‰è£…æ–° APK

**å¯èƒ½åŸå› ï¼š** æ–° APK çš„ versionCode å°äºå·²å®‰è£…ç‰ˆæœ¬

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ç‰ˆæœ¬å·ï¼š`./scripts/check_version.sh`
2. ç¡®ä¿æ–°ç‰ˆæœ¬å·å¤§äºå·²å®‰è£…ç‰ˆæœ¬
3. åŒæ­¥ç‰ˆæœ¬å·ï¼š`./scripts/sync_version.sh`

### é—®é¢˜ï¼šGitHub Actions æ„å»ºå¤±è´¥

**å¯èƒ½åŸå› ï¼š** Git æ¨é€æƒé™é—®é¢˜

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ä»“åº“è®¾ç½® â†’ Actions â†’ General
2. ç¡®ä¿ "Workflow permissions" è®¾ç½®ä¸º "Read and write permissions"
3. å¯ç”¨ "Allow GitHub Actions to create and approve pull requests"

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Android ç‰ˆæœ¬ç®¡ç†](https://developer.android.com/studio/publish/versioning)
- [è¯­ä¹‰åŒ–ç‰ˆæœ¬ 2.0.0](https://semver.org/lang/zh-CN/)
- [Flutter æ„å»ºé…ç½®](https://docs.flutter.dev/deployment/android#build-an-apk)

---

**æœ€åæ›´æ–°ï¼š** 2025-10-23
**ç»´æŠ¤è€…ï¼š** GitHub Actions & Development Team
