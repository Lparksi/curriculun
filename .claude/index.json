{
  "projectName": "curriculum",
  "description": "Flutter课程表应用 - 跨平台智能课程管理",
  "version": "1.0.0+1",
  "lastUpdated": "2025-10-16T14:50:51+08:00",
  "scanner": "init-architect",
  "coverage": {
    "totalFiles": 15,
    "scannedFiles": 15,
    "coveragePercent": 100,
    "modules": {
      "identified": 5,
      "documented": 5
    }
  },
  "modules": [
    {
      "path": "lib/models",
      "name": "数据模型层",
      "description": "核心数据结构定义,JSON序列化支持",
      "files": [
        "course.dart",
        "semester_settings.dart",
        "time_table.dart"
      ],
      "documentation": "lib/models/CLAUDE.md",
      "dependencies": [],
      "dependents": ["services", "pages", "widgets"],
      "keyClasses": ["Course", "SectionTime", "SectionTimeTable (已废弃)", "SemesterSettings", "TimeTable"],
      "coverage": {
        "hasInterface": true,
        "hasTests": false,
        "hasDataModel": true,
        "missingItems": ["单元测试", "TimeTable 文档更新"]
      }
    },
    {
      "path": "lib/services",
      "name": "业务逻辑服务层",
      "description": "数据处理、外部资源交互、业务逻辑封装",
      "files": [
        "course_service.dart",
        "settings_service.dart",
        "time_table_service.dart"
      ],
      "documentation": "lib/services/CLAUDE.md",
      "dependencies": ["models", "utils", "shared_preferences"],
      "dependents": ["pages"],
      "keyClasses": ["CourseService", "SettingsService", "TimeTableService"],
      "coverage": {
        "hasInterface": true,
        "hasTests": false,
        "hasDataModel": false,
        "missingItems": ["单元测试", "TimeTableService 文档更新"]
      }
    },
    {
      "path": "lib/pages",
      "name": "页面组件层",
      "description": "完整页面组件,页面级状态管理",
      "files": [
        "course_table_page.dart",
        "course_management_page.dart",
        "semester_settings_page.dart",
        "time_table_management_page.dart"
      ],
      "documentation": "lib/pages/CLAUDE.md",
      "dependencies": ["models", "services", "widgets", "utils"],
      "dependents": [],
      "keyClasses": ["CourseTablePage", "CourseManagementPage", "SemesterSettingsPage", "TimeTableManagementPage"],
      "coverage": {
        "hasInterface": true,
        "hasTests": false,
        "hasDataModel": false,
        "missingItems": ["Widget测试", "TimeTableManagementPage 文档更新"]
      }
    },
    {
      "path": "lib/widgets",
      "name": "可复用组件层",
      "description": "Dialog、表单等可复用UI组件",
      "files": [
        "course_detail_dialog.dart",
        "course_edit_dialog.dart",
        "time_table_edit_dialog.dart"
      ],
      "documentation": "lib/widgets/CLAUDE.md",
      "dependencies": ["models", "services"],
      "dependents": ["pages"],
      "keyClasses": ["CourseDetailDialog", "CourseEditDialog", "TimeTableEditDialog"],
      "coverage": {
        "hasInterface": true,
        "hasTests": false,
        "hasDataModel": false,
        "missingItems": ["Widget测试", "TimeTableEditDialog 文档更新"]
      }
    },
    {
      "path": "lib/utils",
      "name": "工具函数层",
      "description": "通用工具、算法、常量定义",
      "files": [
        "course_colors.dart"
      ],
      "documentation": "lib/utils/CLAUDE.md",
      "dependencies": [],
      "dependents": ["services"],
      "keyClasses": ["CourseColorManager"],
      "coverage": {
        "hasInterface": true,
        "hasTests": false,
        "hasDataModel": false,
        "missingItems": ["单元测试"]
      }
    }
  ],
  "architecture": {
    "pattern": "分层架构",
    "layers": [
      "应用层 (pages + widgets)",
      "服务层 (services)",
      "数据层 (models)",
      "工具层 (utils)",
      "存储层 (SharedPreferences + Assets)"
    ],
    "stateManagement": "StatefulWidget + setState",
    "dataFlow": "单向数据流 (上层依赖下层)"
  },
  "techStack": {
    "framework": "Flutter 3.35.6",
    "language": "Dart 3.9.2",
    "platforms": ["Android", "Web"],
    "dependencies": {
      "shared_preferences": "^2.3.3",
      "cupertino_icons": "^1.0.8",
      "flutter_localizations": "SDK"
    },
    "devDependencies": {
      "flutter_test": "SDK",
      "flutter_lints": "^5.0.0"
    }
  },
  "features": [
    "可视化周历课程表",
    "学期设置与周次管理",
    "课程CRUD操作",
    "智能颜色分配(18色高辨识度)",
    "本地数据持久化",
    "时间冲突检测",
    "多语言支持(中文/英文)",
    "自定义时间表管理(新增)"
  ],
  "keyAlgorithms": [
    {
      "name": "周次计算",
      "location": "lib/pages/course_table_page.dart:109-114",
      "complexity": "O(1)"
    },
    {
      "name": "课程时间冲突检测",
      "location": "lib/services/course_service.dart:135-165",
      "complexity": "O(n)"
    },
    {
      "name": "智能颜色分配",
      "location": "lib/utils/course_colors.dart:38-49",
      "complexity": "O(1)"
    },
    {
      "name": "时间格式验证",
      "location": "lib/services/time_table_service.dart:171-174",
      "complexity": "O(1)"
    }
  ],
  "storageSchema": {
    "sharedPreferences": {
      "saved_courses": {
        "type": "String (JSON)",
        "description": "课程数据列表"
      },
      "semester_settings": {
        "type": "String (JSON)",
        "description": "学期设置"
      },
      "time_tables": {
        "type": "String (JSON)",
        "description": "时间表列表"
      },
      "active_time_table_id": {
        "type": "String",
        "description": "当前激活的时间表ID"
      }
    },
    "assets": {
      "courses.json": {
        "type": "JSON",
        "description": "默认课程数据模板(19门课程)"
      }
    }
  },
  "documentation": {
    "root": "CLAUDE.md",
    "modules": [
      "lib/models/CLAUDE.md",
      "lib/services/CLAUDE.md",
      "lib/pages/CLAUDE.md",
      "lib/widgets/CLAUDE.md",
      "lib/utils/CLAUDE.md"
    ],
    "hasMermaidDiagrams": true,
    "hasBreadcrumbs": true
  },
  "gaps": [
    {
      "type": "testing",
      "severity": "high",
      "description": "缺少所有单元测试和Widget测试",
      "recommendation": "为 services 层和 widgets 层添加测试覆盖"
    },
    {
      "type": "documentation",
      "severity": "medium",
      "description": "模块级文档需要更新以包含 TimeTable 相关内容",
      "affectedFiles": [
        "lib/models/CLAUDE.md",
        "lib/services/CLAUDE.md",
        "lib/pages/CLAUDE.md",
        "lib/widgets/CLAUDE.md"
      ],
      "recommendation": "更新各模块文档反映新增的自定义时间表功能"
    },
    {
      "type": "testing",
      "severity": "medium",
      "description": "test/widget_test.dart 包含示例测试代码,与实际应用不匹配",
      "recommendation": "删除示例测试或更新为实际测试用例"
    }
  ],
  "nextSteps": {
    "immediate": [
      "更新 lib/models/CLAUDE.md 包含 TimeTable 和 SectionTime 模型文档",
      "更新 lib/services/CLAUDE.md 包含 TimeTableService 文档",
      "更新 lib/pages/CLAUDE.md 包含 TimeTableManagementPage 文档",
      "更新 lib/widgets/CLAUDE.md 包含 TimeTableEditDialog 文档"
    ],
    "recommendations": [
      "添加 TimeTableService 单元测试",
      "添加 CourseService.hasTimeConflict() 单元测试",
      "添加时间表时间验证的单元测试",
      "实现课程数据导入/导出功能",
      "优化大数据量场景的性能"
    ],
    "potentialImprovements": [
      "添加课程提醒功能",
      "支持时间表模板库",
      "添加课程笔记功能",
      "支持多学期管理",
      "云端同步支持",
      "支持时间表分享功能"
    ]
  },
  "recentChanges": [
    {
      "date": "2025-10-16",
      "description": "实现自定义时间表完整功能",
      "files": [
        "lib/models/time_table.dart (新增)",
        "lib/services/time_table_service.dart (新增)",
        "lib/pages/time_table_management_page.dart (新增)",
        "lib/widgets/time_table_edit_dialog.dart (新增)",
        "lib/pages/course_table_page.dart (更新)",
        "lib/models/course.dart (更新)"
      ],
      "impact": "用户可以创建和管理多个自定义时间表,支持不同学校的节次时间配置"
    }
  ]
}
